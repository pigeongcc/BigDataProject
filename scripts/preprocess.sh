#!/bin/bash

# setup a Python virtual environment
sudo rm -rf bd_project_team_9
virtualenv bd_project_team_9
source bd_project_team_9/bin/activate
pip install pandas
pip install pylint
pip install pyspark
pip install streamlit
pip install altair
pip install numpy
pip install ipython

# download dataset files from source (Kaggle)
echo
echo "Downloading 1/3: users_export.csv - Cancelled after EDA query 1 conclusion."
# wget -nc -O data/users_export.csv "https://storage.googleapis.com/kagglesdsdata/datasets/1300195/3341890/users_export.csv?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20230502%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20230502T135026Z&X-Goog-Expires=259200&X-Goog-SignedHeaders=host&X-Goog-Signature=2408cb5d9dbc811cb13df62535091a7d43e554aaa7af74090c9acd52fefe42b24c4582bd98a0d5b50fc2695455cfc9b7aabf4753b562c04c2622cc0d9c85d880422a8d7e25e467724b6b939911b264b17d589c061786027441082baebba3afec2785dd3f42307202de2bdd8545f4a9b3b918912567ffccbcbc7ff6d69ee3fef23a744848e6b6323b33bc2be3c4d04c39e3f3070928c4b36c5d0859527288ccbd5716950eea098de0301dd4a82763c86d6cf5f0722d9d664fd7923174bbef966c1b40b57834be06401e8b4436d89cab36711119acaf78f4702028f1288a9186f2c624b50b2321488a441bf4bcd387cb9a06e0a666d4532742e3c441326eddd175"

echo "Downloading 2/3: ratings_export.csv.zip ..."
wget -nc -O data/ratings_export.csv.zip "https://storage.googleapis.com/kaggle-data-sets/1300195/3341890/compressed/ratings_export.csv.zip?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20230511%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20230511T182405Z&X-Goog-Expires=259200&X-Goog-SignedHeaders=host&X-Goog-Signature=5e43d5ec3c5d66b27112bf1a1fbdcac8f960688a5ff04330932dfc4eae992abcf0c3cd6a5e6ca69a62f1701950c3f56208b774fa256baef8b3ca16b6cbc61e5e6e76c367e060d2ce665a0792064c8928722f6f5a8bf775131185b777e9f9258a45a334c359e206dc4a6a4d0ed20ea325bfc6edd469e257ca61a1c9615f6a6f1a3e741a7a46564c2d44d41d4bacbd15b13f3b280966a42635a8bffdb2ccc7e646546c76f8fb60f41bf4610431a4d9fef020ba061601e38b26f3b67643e77748f5966b26b4c139c435fd0f6aca11eba837277a29eebaea4c2e3c83d3378fab22180652043f4e23f803a9521704f356cc3b7ae3e77c0327b5e8f9dbbb1635dd89b8"
# extract the zip archive
unzip -n data/ratings_export.csv.zip -d data

echo "Downloading 3/3: movie_data.csv.zip ..."
wget -nc -O data/movie_data.csv.zip "https://storage.googleapis.com/kaggle-data-sets/1300195/3341890/compressed/movie_data.csv.zip?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com%2F20230511%2Fauto%2Fstorage%2Fgoog4_request&X-Goog-Date=20230511T182412Z&X-Goog-Expires=259200&X-Goog-SignedHeaders=host&X-Goog-Signature=a9b9825995b6957850cdb3ef3d5acb4c0e88963ba4e79b99582f979955d10b2da65a020f8610d478701d66ef4a7d972a5be4f8f1a31772e690bece5b0a9ac9579021be38afef6b2b215a27fc3fce7c7de38240a6cda398ab4820ba71bde439cb4b13536143fa3cac5d65cb7baba120bc568d227cda72d0fa05a0104d722dbcda8afea56a5ce0495ede3662398fabe68c4398e5546684bc7bfe47261ef0d7ca6c64fdf9701bf26371cd34e59b5bf7b0eb2d7c937eb9d3e60ccb022dc24f395e2b355f8a63c013e334662b4df9c3144d1e385263116d6d7c5797036dcac0b0eee9e42d59e4f058fba243506c73a93559fca6a654ea986fa470474c29e3945dc591"
# extract the zip archive
unzip -n data/movie_data.csv.zip -d data

echo

# preprocess the csv files before feeding to PostgreSQL
pwd
python scripts/preprocess/preprocess_csv.py
